# This is a machine-readable policy file derived from RULES_OF_AI.md.
# Do not edit this file directly. Propose all changes in the .md file first.
# This file is consumed by CI pipelines and automated agents for enforcement.

version: 1.4
owner: "@jamiescottcraik"
enforcement_level: "strict"

version_control:
  protected_branches:
    - main
    - develop
  require_conventional_commits: true
  enforce_linear_history: true
  merge_strategy: squash
  pr_template_required: true
  feature_branch_naming:
    - '^feat\/[0-9]+-.+'
    - '^fix\/[0-9]+-.+'
  require_issue_link_in_pr: true

architecture:
  provider_neutrality:
    enforced: true
    logic_directories:
      - "src/features"
      - "src/agents"
    provider_directory: "src/integrations/providers"
    allowed_providers: []  # Intentionally strict: no direct provider usage in core logic
  type_safety:
    tool: "mypy"
    mode: "strict"
    enforce_type_hints: true
  async_required_for_io: true
  resource_management: "contextmanagers"

code_quality:
  linting_tools:
    - black
    - ruff
    - isort
  max_complexity: 10
  enforce_resource_management: true

testing:
  tdd_required: true
  coverage_tool: "pytest-cov"
  coverage_threshold: 90
  fail_on_missing_tests: true
  mock_externals: true
  no_quality_gate_bypass: true

security:
  secrets_management:
    tool: "1password_cli"
    disallowed_patterns:
      - ".env"
      - "hardcoded_secrets"
      - "password="
      - "secret="
    enforce_dependency_scanning: true
    enforce_vulnerability_audit: true

documentation:
  require_up_to_date_docs: true
  enforce_docstrings: true
  enforce_changelog_update_on_release: true
  require_adr_for_major_decisions: true
  update_guides_on_change: true

audit:
  ai_contribution_log: "AI_CONTRIB_LOG.yaml"
  require_ai_contrib_log_update: true
  enforce_on_merge: true

accessibility:
  standard: "WCAG 2.1 AA"
  ci_tools:
    - axe
    - lighthouse
  enforce_on_pr: true
  no_accessibility_debt: true

logging:
  structured_json_required: true
  fields:
    - timestamp
    - severity
    - agent_or_module
    - stack_trace
    # Add more fields here as required by your observability stack

error_handling:
  no_silent_failures: true
  resilience:
    retry_on_transient_network_errors: true
    retry_strategy: "exponential_backoff"
    max_retries: 5

escalation:
  triggers:
    - security_failure
    - unclear_requirement
    - policy_violation
  protocol:
    - create_or_update_issue_with_escalation_tag
    - notify_owner: "@jamiescottcraik"
    - document_decision_in_adr

notifications:
  on_policy_violation: "owner"
  channels:
    - github
    - email
    # - slack    # Uncomment if Slack is used for notifications

committing:
  require_agent_signature: true
  signature_format: "[signed-by: {agent_or_username}]"
  # This enforces agent/human signature in all commits and PRs

policy_hierarchy:
  - RULES_OF_AI.md
  - docs/adr/
  - docs/PROJECT_STRUCTURE.md
  - github_issues
  - other_docs
